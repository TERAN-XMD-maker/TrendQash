<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TrendQash — Multi-Country Portal — Part 1</title>
  <meta name="description" content="TrendQash Agencies — localized tasks, payouts, calculators, chatbot, and WhatsApp support."/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg1:#0b1220; --bg2:#0e1426; --border:rgba(255,255,255,0.08);
      --white: #fff; --muted:#a5b4fc; --accent:#22d3ee; --card:#0f172a;
      --canva1:#7bdff6; --canva2:#9b7bff; --canva3:#ffd166; --canva4:#ff6b6b; --canva5:#6bffb3;
    }
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 20% -10%, #18243e 0%, transparent 60%), linear-gradient(180deg, var(--bg1), var(--bg2));
      color:#e5e7eb; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .glass{background:rgba(255,255,255,0.04); border:1px solid var(--border); backdrop-filter:blur(8px); border-radius:16px; box-shadow: 0 10px 40px rgba(0,0,0,.35)}
    .glow-ring{ position:relative }
    .glow-ring:before{ content:""; position:absolute; inset:-1px; border-radius:18px;
      padding:1px; background: conic-gradient(from 0deg, var(--canva1), var(--canva2), var(--canva3), var(--canva4), var(--canva5), var(--canva1));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; animation:ring 6s linear infinite}
    @keyframes ring{to{transform: rotate(360deg)}}

    /* Canva-like alternating card accents */
    .canva-a{ background-image: linear-gradient(135deg, rgba(123,223,246,.18), rgba(155,123,255,.12)); }
    .canva-b{ background-image: linear-gradient(135deg, rgba(255,209,102,.18), rgba(255,107,107,.12)); }
    .canva-c{ background-image: linear-gradient(135deg, rgba(107,255,179,.18), rgba(123,223,246,.12)); }

    /* Stable popup (no drifting) */
    .popup-backdrop{ position: fixed; inset: 0; background: rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index:50 }
    .popup{ width:min(520px,92%); }
    .popup.show { display:flex }

    /* Slide container when switching countries */
    .slide-container{ position: relative; overflow: hidden }
    .slide-track{ will-change: transform; transition: transform .45s ease; display: flex; width: 200% }
    .slide-pane{ width: 100% }

    /* Heartbeat + moving light */
    .heartbeat{ animation: beat 1.4s ease-in-out infinite }
    @keyframes beat{ 0%,100%{transform:scale(1)} 25%{transform:scale(1.02)} 50%{transform:scale(0.98)} 75%{transform:scale(1.02)} }
    .light-sweep{ position: relative; overflow: hidden }
    .light-sweep:after{ content:""; position:absolute; top:0; left:-150%; width:50%; height:100%;
      background: linear-gradient(115deg, transparent 0%, rgba(255,255,255,.15) 45%, rgba(255,255,255,.03) 60%, transparent 100%);
      transform:skewX(-10deg); animation: sweep 3.6s linear infinite }
    @keyframes sweep{ 0%{ left:-150% } 60%{ left:130% } 100%{ left:130% } }

    /* Buttons */
    .btn{ display:inline-flex; align-items:center; gap:.5rem; font-weight:700; border-radius:12px; padding:.7rem 1rem; border:1px solid var(--border) }
    .btn-primary{ background:#0ea5e9; color:#0b1220 }
    .btn-dark{ background:#0f172a; color:#fff }
    .btn-ghost{ background:transparent; color:#e5e7eb }
    .btn-outline{ background:transparent; border-color:#334155 }

    /* Inputs */
    .input{ background: rgba(255,255,255,.04); border:1px solid var(--border); border-radius:12px; padding:.65rem .8rem; width:100%; color:#e5e7eb }

    /* Earnings card expand */
    .card{ border:1px solid var(--border); border-radius:16px; overflow:hidden }
    .card-header{ cursor:pointer; }
    .card-body{ display:none }
    .card.open .card-body{ display:block; animation: fade .25s ease }
    @keyframes fade{ from{opacity:.4; transform: translateY(-4px)} to{opacity:1; transform:none} }

    /* Chip */
    .chip{ padding:.25rem .55rem; border-radius:999px; font-size:.75rem; border:1px solid var(--border); background:rgba(255,255,255,.04); color:#cbd5e1 }

    /* Marquee (legitimacy) */
    .marquee{ overflow:hidden; white-space:nowrap }
    .marquee-track{ display:inline-block; padding-left:100%; animation: marq 18s linear infinite; color:#0b1220; font-weight:800 }
    @keyframes marq{ 0%{transform:translateX(0)} 100%{transform:translateX(-100%)} }

    /* Small tweaks */
    .muted{ color:#a3aed0 }
    .accent{ color:#22d3ee }
    .hstack{ display:flex; align-items:center; gap:.75rem }
    .vstack{ display:flex; flex-direction:column; gap:.75rem }

    /* Responsive grid helpers */
    .grid-1{ display:grid; grid-template-columns:1fr; gap:1rem }
    .grid-2{ display:grid; grid-template-columns:1fr; gap:1rem }
    .grid-3{ display:grid; grid-template-columns:1fr; gap:1rem }
    @media(min-width:640px){ .grid-2{ grid-template-columns: repeat(2, minmax(0,1fr)) } }
    @media(min-width:840px){ .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr)) } }

    /* Prevent layout shift on mobile */
    * { min-width:0 }
  </style>
</head>
<body>
  <!-- Top marquee -->
  <div class="py-2">
    <div class="max-w-7xl mx-auto px-4">
      <div class="bg-white/90 rounded-full px-3 py-2 marquee">
        <div class="marquee-track">
          ✅ TRENDQASH — Registered & Compliant • Country-specific payouts • Activation from KES 550 / GHC 80 / BWP 100 / MWK 12,000 / UGX 20,000 • Weekly withdrawals • WhatsApp Support.
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="max-w-7xl mx-auto px-4 pt-4 pb-2">
    <div class="flex items-start justify-between gap-3">
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold">TrendQash Agencies</h1>
        <p class="text-sm muted mt-1">Localized tasks • Local payouts • Real members</p>
      </div>
      <div class="hstack">
        <button id="switchCountryBtn" class="btn btn-outline">🌍 Switch Country</button>
        <button id="shareBtn" class="btn btn-primary light-sweep">🔗 Share</button>
      </div>
    </div>
  </header>

  <!-- Country chooser popup -->
  <div id="countryPopup" class="popup-backdrop">
    <div class="popup glass glow-ring p-5">
      <h2 class="text-2xl font-extrabold mb-1">Select Your Country</h2>
      <p class="text-sm muted mb-4">Pick your country to see accurate activation fees, payouts, and currency.</p>
      <div class="vstack">
        <select id="countrySelect" class="input">
          <option value="">— Choose country —</option>
          <option value="kenya">🇰🇪 Kenya</option>
          <option value="ghana">🇬🇭 Ghana</option>
          <option value="botswana">🇧🇼 Botswana</option>
          <option value="malawi">🇲🇼 Malawi</option>
          <option value="uganda">🇺🇬 Uganda</option>
        </select>
        <div class="hstack justify-between">
          <button id="chooseCountryBtn" class="btn btn-primary">Continue</button>
          <button id="cancelCountryBtn" class="btn btn-ghost">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Live members + CTA -->
  <section class="max-w-7xl mx-auto px-4 pb-4">
    <div class="glass p-4 rounded-2xl flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
      <div class="hstack">
        <div class="chip">Live this week</div>
        <div>Members joined: <strong id="liveCount">0</strong></div>
      </div>
      <div class="hstack">
        <a id="registerTop" target="_blank" class="btn btn-dark heartbeat light-sweep" href="https://www.trendqash.com/user/register.php?ref=Teranchamp">🚀 How to Join & Register</a>
        <button id="openPopupBtn" class="btn btn-outline">🇺🇳 Choose Country</button>
      </div>
    </div>
  </section>

  <!-- Slide container (for smooth country switch) -->
  <main class="max-w-7xl mx-auto px-4 pb-16 slide-container">
    <div id="slideTrack" class="slide-track">
      <!-- current -->
      <section id="countryPaneCurrent" class="slide-pane">
        <div id="countryContent" class="vstack"></div>
      </section>
      <!-- next (for animation) -->
      <section id="countryPaneNext" class="slide-pane">
        <div id="countryContentNext" class="vstack"></div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="max-w-7xl mx-auto px-4 pb-10">
    <div class="text-center muted text-xs">
      © <span id="year"></span> TrendQash Agencies • Localized earnings portal
    </div>
  </footer>

  <!-- PART 1: markup + styles complete. Part 2 will contain the full JavaScript (bot logic, event wiring, and extra testimonials). -->
  <!-- To keep original content intact, part2 will replicate the original inline script but split into a separate JS file trendqash-part2.js -->
  <script src="trendqash-part2.js"></script>
<!-- ========================== TrendQash Portal — PART 1 ========================== -->
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TrendQash Portal</title>
  <style>
    :root {
      --primary: #3b82f6;
      --secondary: #1e293b;
      --accent: #22c55e;
      --danger: #ef4444;
      --bg-dark: #0f172a;
      --bg-light: #1e293b;
      --text-light: #f1f5f9;
      --text-muted: #94a3b8;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      line-height: 1.6;
    }
    header {
      padding: 1rem;
      background: var(--bg-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    header h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    .country-switcher {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .country-switcher select {
      padding: 0.4rem;
      border-radius: 0.5rem;
      border: none;
      background: var(--secondary);
      color: var(--text-light);
      font-size: 1rem;
    }
    .slide-container {
      display: flex;
      overflow: hidden;
      position: relative;
      width: 100%;
      min-height: 100vh;
    }
    .slide-pane {
      flex: 0 0 100%;
      max-width: 100%;
      transition: transform 0.5s ease-in-out;
      box-sizing: border-box;
      padding: 1rem;
    }
    .section {
      margin: 2rem 0;
      background: var(--bg-light);
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }
    .section h2 {
      margin-top: 0;
      font-size: 1.4rem;
      color: var(--primary);
    }
    .earning-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }
    .earning-card {
      background: var(--secondary);
      padding: 1rem;
      border-radius: 0.8rem;
      text-align: center;
      font-weight: bold;
    }
    .faq-item {
      margin-bottom: 1rem;
    }
    .faq-question {
      cursor: pointer;
      background: var(--secondary);
      padding: 0.8rem;
      border-radius: 0.6rem;
    }
    .faq-answer {
      display: none;
      padding: 0.8rem;
      background: var(--bg-dark);
      border-left: 4px solid var(--primary);
      margin-top: 0.5rem;
      border-radius: 0.4rem;
    }
    .testimonial-card {
      background: var(--secondary);
      padding: 1rem;
      border-radius: 0.8rem;
      margin: 0.5rem 0;
    }
    footer {
      background: var(--bg-light);
      padding: 1rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    @media (max-width: 768px) {
      .country-switcher {
        width: 100%;
        margin-top: 0.5rem;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>🌍 TrendQash Portal</h1>
    <div class="country-switcher">
      <label for="countrySelect">Select Country:</label>
      <select id="countrySelect">
        <option value="kenya" selected>🇰🇪 Kenya</option>
        <option value="ghana">🇬🇭 Ghana</option>
        <option value="uganda">🇺🇬 Uganda</option>
        <option value="botswana">🇧🇼 Botswana</option>
        <option value="malawi">🇲🇼 Malawi</option>
      </select>
    </div>
  </header>

  <!-- Slide container -->
  <div class="slide-container" id="slideContainer">
    <!-- Kenya Pane -->
    <div class="slide-pane" data-country="kenya">
      <div class="section">
        <h2>Ways of Earning — 🇰🇪 Kenya</h2>
        <div class="earning-list">
          <div class="earning-card">🎥 YouTube — KES 50</div>
          <div class="earning-card">🎵 TikTok — KES 50</div>
          <div class="earning-card">📝 Surveys — KES 50</div>
          <div class="earning-card">🎬 Netflix — KES 50</div>
          <div class="earning-card">📣 Referrals — KES 300</div>
          <div class="earning-card">👩‍💼 Agent — KES 500</div>
        </div>
      </div>
      <div class="section">
        <h2>FAQs — 🇰🇪 Kenya</h2>
        <div class="faq-item">
          <div class="faq-question">How do I get started?</div>
          <div class="faq-answer">Simply register, pay the activation fee, and start earning from the tasks provided.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">How fast are payouts?</div>
          <div class="faq-answer">Most payouts reflect instantly to your M-Pesa account.</div>
        </div>
      </div>
      <div class="section">
        <h2>Member Testimonials — 🇰🇪 Kenya</h2>
        <div class="testimonial-card">“I earned KES 9,600 combining referrals & videos.” — Abigail W., Nairobi</div>
        <div class="testimonial-card">“Quick payouts and helpful support.” — Peter O., Nakuru</div>
      </div>
    </div>

    <!-- Ghana Pane -->
    <div class="slide-pane" data-country="ghana">
      <div class="section">
        <h2>Ways of Earning — 🇬🇭 Ghana</h2>
        <div class="earning-list">
          <div class="earning-card">🎥 YouTube — GHS 12</div>
          <div class="earning-card">🎵 TikTok — GHS 12</div>
          <div class="earning-card">📝 Surveys — GHS 10</div>
          <div class="earning-card">🎬 Netflix — GHS 10</div>
          <div class="earning-card">📣 Referrals — GHS 20</div>
          <div class="earning-card">👩‍💼 Agent — GHS 20</div>
        </div>
      </div>
      <div class="section">
        <h2>FAQs — 🇬🇭 Ghana</h2>
        <div class="faq-item">
          <div class="faq-question">How do I withdraw?</div>
          <div class="faq-answer">Withdrawals are processed through MTN MoMo, Vodafone Cash, or AirtelTigo.</div>
        </div>
        <div class="faq-item">
          <div class="faq-question">Is there an activation fee?</div>
          <div class="faq-answer">Yes, activation is required to unlock earning opportunities.</div>
        </div>
      </div>
      <div class="section">
        <h2>Member Testimonials — 🇬🇭 Ghana</h2>
        <div class="testimonial-card">“MoMo cashouts hit fast!” — Kofi A., Accra</div>
      </div>
    </div>

    <!-- Uganda Pane -->
    <div class="slide-pane" data-country="uganda">
      <div class="section">
        <h2>Ways of Earning — 🇺🇬 Uganda</h2>
        <div class="earning-list">
          <div class="earning-card">🎥 YouTube — UGX 50</div>
          <div class="earning-card">🎵 TikTok — UGX 50</div>
          <div class="earning-card">📝 Surveys — UGX 50</div>
          <div class="earning-card">🎬 Netflix — UGX 50</div>
          <div class="earning-card">📣 Referrals — UGX 300</div>
          <div class="earning-card">👩‍💼 Agent — UGX 500</div>
        </div>
      </div>
      <div class="section">
        <h2>FAQs — 🇺🇬 Uganda</h2>
        <div class="faq-item">
          <div class="faq-question">What is the activation fee?</div>
          <div class="faq-answer">The activation fee in Uganda is UGX 20,000.</div>
        </div>
      </div>
      <div class="section">
        <h2>Member Testimonials — 🇺🇬 Uganda</h2>
        <div class="testimonial-card">“Earnings reflect instantly via MTN MoMo.” — Sarah L., Kampala</div>
      </div>
    </div>

    <!-- Botswana Pane -->
    <div class="slide-pane" data-country="botswana">
      <div class="section">
        <h2>Ways of Earning — 🇧🇼 Botswana</h2>
        <div class="earning-list">
          <div class="earning-card">🎥 YouTube — BWP 12</div>
          <div class="earning-card">🎵 TikTok — BWP 12</div>
          <div class="earning-card">📝 Surveys — BWP 12</div>
          <div class="earning-card">🎬 Netflix — BWP 12</div>
          <div class="earning-card">📣 Referrals — BWP 20</div>
          <div class="earning-card">👩‍💼 Agent — BWP 20</div>
        </div>
      </div>
      <div class="section">
        <h2>FAQs — 🇧🇼 Botswana</h2>
        <div class="faq-item">
          <div class="faq-question">How are payments made?</div>
          <div class="faq-answer">Payments are made through Orange Money and MyZaka.</div>
        </div>
      </div>
      <div class="section">
        <h2>Member Testimonials — 🇧🇼 Botswana</h2>
        <div class="testimonial-card">“Referral earnings are the best!” — Tumelo K., Gaborone</div>
      </div>
    </div>

    <!-- Malawi Pane -->
    <div class="slide-pane" data-country="malawi">
      <div class="section">
        <h2>Ways of Earning — 🇲🇼 Malawi</h2>
        <div class="earning-list">
          <div class="earning-card">🎥 YouTube — MWK 12</div>
          <div class="earning-card">🎵 TikTok — MWK 12</div>
          <div class="earning-card">📝 Surveys — MWK 12</div>
          <div class="earning-card">🎬 Netflix — MWK 12</div>
          <div class="earning-card">📣 Referrals — MWK 20</div>
          <div class="earning-card">👩‍💼 Agent — MWK 20</div>
        </div>
      </div>
      <div class="section">
        <h2>FAQs — 🇲🇼 Malawi</h2>
        <div class="faq-item">
          <div class="faq-question">What’s the payout method?</div>
          <div class="faq-answer">Payments are made through Airtel Money and TNM Mpamba.</div>
        </div>
      </div>
      <div class="section">
        <h2>Member Testimonials — 🇲🇼 Malawi</h2>
        <div class="testimonial-card">“The payouts are reliable and quick.” — Blessings C., Lilongwe</div>
      </div>
    </div>
  </div>

  <footer>
    © 2025 TrendQash Agencies • Localized earnings portal
  </footer>

  <!-- Hook scripts -->
  <script src="trendqash-part2.js"></script>
  <script src="trendqash-part2a.js"></script>
  <script src="trendqash-part2b.js"></script>
<!-- ========================== TrendQash Portal — SCRIPT PART 2 ========================== -->
<script>
// =======================================================================
// TrendQash — Core Interactive Script (Part 2)
// =======================================================================
// This file powers: 
// 1. Country switcher (desktop slide + mobile dropdown)
// 2. SlidePane rendering and responsive behavior
// 3. Base hooks for Bots, FAQs, Testimonials (extended in Part 2A + 2B)
// =======================================================================


// -----------------------------------------------------------------------
// UTILITY FUNCTIONS
// -----------------------------------------------------------------------

// Helper: Select element by ID
function $(id) {
  return document.getElementById(id);
}

// Helper: Select multiple elements
function $all(selector, scope = document) {
  return Array.from(scope.querySelectorAll(selector));
}

// Helper: Create element
function createEl(tag, cls, html) {
  const el = document.createElement(tag);
  if (cls) el.className = cls;
  if (html) el.innerHTML = html;
  return el;
}

// -----------------------------------------------------------------------
// GLOBAL CONFIG
// -----------------------------------------------------------------------

const TrendQash = {
  version: "2.0-core",
  currentCountry: "kenya",
  countries: {},
  panes: [],
  events: {},
  initDone: false,
};

// -----------------------------------------------------------------------
// EVENT DISPATCH SYSTEM
// -----------------------------------------------------------------------

TrendQash.on = function (event, cb) {
  if (!TrendQash.events[event]) TrendQash.events[event] = [];
  TrendQash.events[event].push(cb);
};

TrendQash.emit = function (event, payload) {
  (TrendQash.events[event] || []).forEach((cb) => cb(payload));
};

// -----------------------------------------------------------------------
// COUNTRY DATA — extended later by Part 2A + 2B
// -----------------------------------------------------------------------

TrendQash.countries = {
  kenya: {
    key: "kenya",
    name: "Kenya",
    flag: "🇰🇪",
    currency: "KES",
    activationFee: 550,
    rateToUSD: 0.0076,
    payments: ["M-Pesa"],
    note: "Activation is handled in registration flow.",
  },
  ghana: {
    key: "ghana",
    name: "Ghana",
    flag: "🇬🇭",
    currency: "GHS",
    activationFee: 80,
    rateToUSD: 0.083,
    payments: ["MTN MoMo", "AirtelTigo", "Vodafone Cash"],
    note: "Activation handled in platform page.",
  },
  uganda: {
    key: "uganda",
    name: "Uganda",
    flag: "🇺🇬",
    currency: "UGX",
    activationFee: 20000,
    rateToUSD: 0.00027,
    payments: ["MTN Uganda", "Airtel Money"],
    note: "Activation via platform.",
  },
};

// -----------------------------------------------------------------------
// RENDER COUNTRY SWITCHER (TOP BAR DROPDOWN + DESKTOP BUTTONS)
// -----------------------------------------------------------------------

function renderCountrySwitcher() {
  const switcher = $("country-switcher");
  if (!switcher) return;

  // Desktop buttons
  const btnRow = createEl("div", "country-btn-row");
  Object.values(TrendQash.countries).forEach((c) => {
    const btn = createEl("button", "country-btn", `${c.flag} ${c.name}`);
    btn.onclick = () => TrendQash.setCountry(c.key);
    btnRow.appendChild(btn);
  });

  // Mobile dropdown
  const select = createEl("select", "country-select");
  Object.values(TrendQash.countries).forEach((c) => {
    const opt = createEl("option", "", `${c.flag} ${c.name}`);
    opt.value = c.key;
    select.appendChild(opt);
  });
  select.onchange = (e) => TrendQash.setCountry(e.target.value);

  switcher.innerHTML = "";
  switcher.appendChild(btnRow);
  switcher.appendChild(select);
}

// -----------------------------------------------------------------------
// RENDER COUNTRY PANES
// -----------------------------------------------------------------------

function renderCountryPanes() {
  const container = $("country-panes");
  if (!container) return;

  container.innerHTML = "";
  TrendQash.panes = [];

  Object.values(TrendQash.countries).forEach((c) => {
    const pane = createEl("div", "slide-pane");
    pane.setAttribute("data-country", c.key);

    // Title
    const h2 = createEl("h2", "pane-title", `${c.flag} ${c.name}`);
    pane.appendChild(h2);

    // Activation Fee
    const fee = createEl("p", "activation-fee", 
      `Activation Fee: ${c.activationFee} ${c.currency}`);
    pane.appendChild(fee);

    // Payments
    const pay = createEl("p", "payments", 
      `Payments: ${c.payments.join(", ")}`);
    pane.appendChild(pay);

    // Note
    const note = createEl("p", "country-note", c.note);
    pane.appendChild(note);

    container.appendChild(pane);
    TrendQash.panes.push(pane);
  });
}

// -----------------------------------------------------------------------
// COUNTRY SWITCHING LOGIC
// -----------------------------------------------------------------------

TrendQash.setCountry = function (key) {
  if (!TrendQash.countries[key]) return;
  TrendQash.currentCountry = key;

  // Highlight correct pane
  TrendQash.panes.forEach((p) => {
    if (p.getAttribute("data-country") === key) {
      p.style.display = "block";
    } else {
      p.style.display = "none";
    }
  });

  // Emit event
  TrendQash.emit("countryChanged", key);
};

// -----------------------------------------------------------------------
// INIT APP
// -----------------------------------------------------------------------

TrendQash.init = function () {
  if (TrendQash.initDone) return;
  renderCountrySwitcher();
  renderCountryPanes();
  TrendQash.setCountry("kenya");
  TrendQash.initDone = true;
};

// -----------------------------------------------------------------------
// RUNTIME STYLES (Responsive Fixes)
// -----------------------------------------------------------------------

function injectStyles() {
  const css = `
    .country-btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .country-btn {
      background: #1f2937;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .country-btn:hover {
      background: #374151;
    }
    .country-select {
      display: none;
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      margin-top: 10px;
    }
    @media(max-width: 768px) {
      .country-btn-row { display: none; }
      .country-select { display: block; }
    }
    .slide-pane {
      width: 100%;
      padding: 16px;
      background: #111827;
      border-radius: 12px;
      margin-bottom: 20px;
      color: #e5e7eb;
    }
    .pane-title {
      font-size: 20px;
      margin-bottom: 10px;
    }
    .activation-fee, .payments, .country-note {
      margin: 4px 0;
    }
  `;
  const style = document.createElement("style");
  style.textContent = css;
  document.head.appendChild(style);
}

// -----------------------------------------------------------------------
// AUTO INIT ON DOM READY
// -----------------------------------------------------------------------

document.addEventListener("DOMContentLoaded", () => {
  injectStyles();
  TrendQash.init();
});


// =======================================================================
// RESERVED HOOKS — to be extended in Part 2A and Part 2B
// =======================================================================

// Bots will register here
TrendQash.bots = {};

// FAQs and testimonials injected later
TrendQash.faqs = [];
TrendQash.testimonials = [];

// Export for debugging
window.TrendQash = TrendQash;

</script>
<!-- ========================== END OF PART 2 ========================== -->
// ===================== trendqash-part2b.js =====================
// Part 2B — Continued: chat persistence, extra testimonials injection,
// export chat feature, improved estimator parsing, onboarding templates UI,
// and final polishing (ensures WhatsApp send message available from UI).
//
// This file builds on Part2A and Part2 core. It is safe to load after them.

// ---------------------------------------------------------------------
// Safety guard
// ---------------------------------------------------------------------
if (!window.TrendQash || !window.TrendQash.BotManager) {
  console.error("trendqash-part2b.js requires Part2 core and Part2A (BotManager). Aborting.");
} else (function (TQ) {

  // -------------------------------------------------------------------
  // Extra testimonials (non-destructive): appended into any testimonial containers
  // we can find. This does not remove existing testimonials.
  // -------------------------------------------------------------------
  const EXTRA_TESTIMONIALS = {
    kenya: [
      { quote: "I covered my activation fee in 2 days with referrals.", name: "Moses L.", city: "Nairobi" },
      { quote: "Friendly support and steady payouts.", name: "Aisha R.", city: "Thika" }
    ],
    ghana: [
      { quote: "I withdrew via MoMo within 3 days.", name: "Yaw B.", city: "Kumasi" }
    ],
    uganda: [
      { quote: "Support helped me through my first withdrawal.", name: "Grace K.", city: "Kampala" }
    ],
    botswana: [
      { quote: "Good side income while studying.", name: "Naledi S.", city: "Francistown" }
    ],
    malawi: [
      { quote: "Mpamba worked perfect for my withdrawals.", name: "Ben S.", city: "Blantyre" }
    ]
  };

  function appendExtraTestimonials() {
    Object.keys(EXTRA_TESTIMONIALS).forEach((countryKey) => {
      // locate testimonial area in the slide-pane for this country
      const pane = document.querySelector(`.slide-pane[data-country="${countryKey}"]`);
      if (!pane) return;
      // find testimonials section by header text, fallback: first .testimonial-card parent
      const sec = Array.from(pane.querySelectorAll(".section")).find(s => s.innerText && s.innerText.includes("Member Testimonials"));
      const host = sec || pane;
      // append cards
      EXTRA_TESTIMONIALS[countryKey].forEach(t => {
        const card = document.createElement("div");
        card.className = "testimonial-card";
        card.textContent = `“${t.quote}” — ${t.name}, ${t.city}`;
        host.appendChild(card);
      });
    });
  }

  // run once DOM ready
  document.addEventListener("DOMContentLoaded", appendExtraTestimonials);

  // -------------------------------------------------------------------
  // Chat persistence: save/restore last 30 messages per country
  // store under localStorage key: tq_chat_<country>
  // -------------------------------------------------------------------
  function saveChatState(countryKey) {
    const box = document.getElementById(`${countryKey}_messages`);
    if (!box) return;
    const nodes = Array.from(box.children);
    const payload = nodes.map(n => {
      // user bubble detection
      if (n.classList && n.classList.contains("user")) return { t: "u", text: n.textContent.trim() };
      if (n.classList && n.classList.contains("bot")) return { t: "b", text: n.textContent.trim() };
      // links or buttons in wrapper
      const a = n.querySelector && n.querySelector("a");
      if (a) return { t: "l", href: a.href, label: a.textContent.trim() };
      // options chips
      const chips = n.querySelectorAll && n.querySelectorAll(".chip");
      if (chips && chips.length) return { t: "o", opts: Array.from(chips).map(c => c.textContent.trim()) };
      return null;
    }).filter(Boolean).slice(-30);
    try {
      localStorage.setItem(`tq_chat_${countryKey}`, JSON.stringify(payload));
    } catch (e) { /* ignore */ }
  }

  function restoreChatState(countryKey) {
    const box = document.getElementById(`${countryKey}_messages`);
    if (!box) return;
    const raw = localStorage.getItem(`tq_chat_${countryKey}`);
    if (!raw) return;
    try {
      const items = JSON.parse(raw);
      box.innerHTML = "";
      items.forEach(it => {
        if (it.t === "u") {
          const d = document.createElement("div"); d.className = "chat-msg user"; d.textContent = it.text; box.appendChild(d);
        } else if (it.t === "b") {
          const d = document.createElement("div"); d.className = "chat-msg bot"; d.textContent = it.text; box.appendChild(d);
        } else if (it.t === "l") {
          const wrap = document.createElement("div"); wrap.className = "chat-msg bot"; const a = document.createElement("a"); a.href = it.href; a.textContent = it.label; a.target = "_blank"; a.className = "btn btn-primary"; wrap.appendChild(a); box.appendChild(wrap);
        } else if (it.t === "o") {
          const wrap = document.createElement("div"); wrap.className = "chat-msg bot"; const cont = document.createElement("div"); cont.className = "tq-options"; it.opts.forEach(o => { const c = document.createElement("button"); c.className = "chip"; c.textContent = o; cont.appendChild(c); }); wrap.appendChild(cont); box.appendChild(wrap);
        }
      });
      box.scrollTop = box.scrollHeight;
    } catch (e) { console.warn("restoreChatState parse error", e); }
  }

  // Mutation observer to autosave when chat box changes
  function observeChatBox(countryKey) {
    const box = document.getElementById(`${countryKey}_messages`);
    if (!box) return;
    const mo = new MutationObserver(() => saveChatState(countryKey));
    mo.observe(box, { childList: true, subtree: true });
    // restore immediately
    restoreChatState(countryKey);
  }

  // Attach observers for all known countries once DOM ready
  document.addEventListener("DOMContentLoaded", () => {
    Object.keys(TQ.countries || {}).forEach(k => observeChatBox(k));
  });

  // -------------------------------------------------------------------
  // Enhanced estimator parsing (accept more phrases)
  // -------------------------------------------------------------------
  TQ.BotManager.register(async (ctx) => {
    // more robust patterns:
    // "If I do 200 surveys", "how much for 50 youtube", "200 tiktok", "earn 500 memes"
    const text = (ctx.text || "").toLowerCase();
    const norm = text.replace(/,/g, "");
    const match = norm.match(/(\d{1,7})\s*(youtube|tiktok|surveys|memes|referrals|agent|ebooks|welcome|netflix)?/);
    if (!match) return;
    const qty = Number(match[1]);
    let activity = match[2] || null;
    if (!activity) {
      if (norm.includes("survey")) activity = "surveys";
      else if (norm.includes("youtube")) activity = "youtube";
      else if (norm.includes("tiktok")) activity = "tiktok";
      else if (norm.includes("memes")) activity = "memes";
      else if (norm.includes("referral")) activity = "referrals";
    }
    if (!activity) return;
    const cfg = TQ.countries[ctx.country] || {};
    const per = (cfg.methods && cfg.methods[activity]) ? cfg.methods[activity] : 0;
    const total = per * qty;
    const usd = cfg.rateToUSD ? (total * cfg.rateToUSD) : 0;
    ctx.replies.push(`${qty} × ${cfg.currency || ""} ${TQfmt(per)} (${activity}) = ${cfg.currency || ""} ${TQfmt(total)} (~$${usd.toFixed(2)})`);
  });

  // -------------------------------------------------------------------
  // Onboarding templates UI utility
  // - Injects a small "Pre-typed messages" panel into the chat box of a country
  // -------------------------------------------------------------------
  function injectOnboardingTemplates(countryKey) {
    const box = document.getElementById(`${countryKey}_messages`);
    if (!box) return;
    const templates = [
      { label: "I need help registering", text: `Hi, I tried to register but I'm stuck at activation. My name: [Your Name].` },
      { label: "How to withdraw", text: `Hi, please guide me on how to withdraw to my local method. My account email: [email@example.com]` },
      { label: "Account verification", text: `Hello, I want to complete verification for larger withdrawals. My name: [Your Name]` }
    ];
    const container = document.createElement("div");
    container.className = "tq-templates";
    const title = document.createElement("div");
    title.textContent = "Pre-typed messages:";
    title.style.fontWeight = "700";
    container.appendChild(title);
    const list = document.createElement("div");
    list.style.display = "flex";
    list.style.flexDirection = "column";
    list.style.gap = "8px";
    templates.forEach(t => {
      const btn = document.createElement("button");
      btn.className = "btn btn-outline";
      btn.style.justifyContent = "flex-start";
      btn.textContent = t.label;
      btn.addEventListener("click", () => {
        // overlay edit modal
        const overlay = document.createElement("div");
        overlay.className = "popup-backdrop show";
        overlay.style.position = "fixed";
        overlay.style.inset = "0";
        overlay.style.background = "rgba(0,0,0,0.6)";
        overlay.style.display = "flex";
        overlay.style.alignItems = "center";
        overlay.style.justifyContent = "center";
        overlay.style.zIndex = 9999;
        const popup = document.createElement("div");
        popup.className = "popup glass";
        popup.style.background = "#0b1220";
        popup.style.padding = "16px";
        popup.style.borderRadius = "12px";
        popup.style.width = "min(640px,92%)";
        popup.innerHTML = `<h3 style="margin:0 0 8px 0">Send message</h3>
            <textarea id="tq_temp_msg" rows="6" style="width:100%; padding:8px; border-radius:8px; background:#0f172a; color:#e5e7eb; border:1px solid rgba(255,255,255,0.06)">${t.text}</textarea>
            <div style="display:flex; gap:8px; margin-top:8px; justify-content:flex-end">
              <button id="tq_temp_send" class="btn btn-primary">Send to chat</button>
              <button id="tq_temp_wa" class="btn btn-outline">Open in WhatsApp</button>
              <button id="tq_temp_cancel" class="btn btn-ghost">Cancel</button>
            </div>`;
        overlay.appendChild(popup);
        document.body.appendChild(overlay);
        popup.querySelector("#tq_temp_cancel").addEventListener("click", () => document.body.removeChild(overlay));
        popup.querySelector("#tq_temp_send").addEventListener("click", () => {
          const val = popup.querySelector("#tq_temp_msg").value;
          // post user message and run bot
          const input = document.getElementById(`${countryKey}_chat_in`);
          if (input) input.value = val;
          if (TQ.sendChat) TQ.sendChat(countryKey);
          document.body.removeChild(overlay);
        });
        popup.querySelector("#tq_temp_wa").addEventListener("click", () => {
          const val = popup.querySelector("#tq_temp_msg").value;
          openWhatsAppWithMessage(val);
          document.body.removeChild(overlay);
        });
      });
      list.appendChild(btn);
    });
    container.appendChild(list);
    box.appendChild(container);
    box.scrollTop = box.scrollHeight;
  }

  // expose for admin or UI usage
  TQ.injectOnboardingTemplates = injectOnboardingTemplates;

  // -------------------------------------------------------------------
  // Export chat feature: register a command "export chat" or "download chat"
  // When user types such, bot will reply with a downloadable file link.
  // -------------------------------------------------------------------
  TQ.BotManager.register(async (ctx) => {
    const lc = (ctx.text || "").toLowerCase();
    if (!(lc.includes("export chat") || lc.includes("download chat"))) return;
    const box = document.getElementById(`${ctx.country}_messages`);
    if (!box) {
      ctx.replies.push("No chat to export.");
      return;
    }
    const lines = Array.from(box.children).map(n => n.textContent.trim()).filter(Boolean);
    const blob = new Blob([lines.join("\n\n")], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    ctx.replies.push({ type: "wa-link", href: url, label: "Download conversation" });
  });

  // -------------------------------------------------------------------
  // Utility: openWhatsAppWithMessage (ensure it's available globally)
  // -------------------------------------------------------------------
  function openWhatsAppWithMessage(msg) {
    const phone = TQ_SUPPORT_NUMBER.replace(/\+|\s+/g, "");
    const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
    window.open(url, "_blank");
    return url;
  }
  // ensure global access
  window.openWhatsAppWithMessage = openWhatsAppWithMessage;

  // -------------------------------------------------------------------
  // Small helper formatting function (exposed if not present)
  // -------------------------------------------------------------------
  if (!window.TQfmt) window.TQfmt = function (n) { return Number(n || 0).toLocaleString(); };

  // -------------------------------------------------------------------
  // Attach some UI polish styles (if not present)
  // -------------------------------------------------------------------
  (function injectPart2bStyles() {
    const css = `
    .btn-outline { background: transparent; border:1px solid rgba(255,255,255,0.06); color:#e5e7eb; padding:8px 10px; border-radius:8px; cursor:pointer; }
    .btn-ghost { background:transparent; border:none; color:#e5e7eb; padding:8px; cursor:pointer; }
    .popup-backdrop.show { display:flex; }
    .glass { background: rgba(255,255,255,0.03); border-radius:12px; padding:8px; border:1px solid rgba(255,255,255,0.04); }
    `;
    const s = document.createElement("style"); s.textContent = css; document.head.appendChild(s);
  })();

  // -------------------------------------------------------------------
  // Finalize: after DOM loaded, attempt to inject onboarding templates
  // into all chat boxes and ensure persistence observers are set
  // -------------------------------------------------------------------
  document.addEventListener("DOMContentLoaded", () => {
    Object.keys(TQ.countries || {}).forEach(k => {
      // restore chat if any
      try { restoreChatState(k); } catch (e) { /* ignore */ }
      // inject templates UI button if chat exists
      const messages = document.getElementById(`${k}_messages`);
      if (messages) {
        // add "Templates" quick button if not present
        const already = messages.querySelector(".tq-templates");
        if (!already) injectOnboardingTemplates(k);
      }
    });
  });

  // -------------------------------------------------------------------
  // Indicate Part2B loaded
  // -------------------------------------------------------------------
  console.info("trendqash-part2b.js loaded — persistence, templates, extras active.");
})(window.TrendQash);

</body>
</html>